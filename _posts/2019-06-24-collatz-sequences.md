---
layout: post
title:  "Collatz sequences"
date:   2019-06-24 17:20 -0800
category: Programming
tags: math python
---

The [Collatz sequence](http://mathworld.wolfram.com/CollatzProblem.html) for a whole number _n_ is generated by iterating:

$$
a_n = \begin{cases}
\frac{1}{2} a_{n-1} & \text{if $a_{n-1}$ is even} \\
3 a_{n-1} + 1 & \text{if $a_{n-1}$ is odd}
\end{cases}
$$

The [Collatz conjecture](https://en.wikipedia.org/wiki/Collatz_conjecture) states that this sequence always terminates at 1. The Wikipedia entry has a [graph](https://en.wikipedia.org/wiki/Collatz_conjecture#/media/File:Collatz1000mathematica.png) by [Jon McLoone](http://jon.mcloone.info/), Director at Wolfram Research and all-around interesting person. I thought that was cool and wanted to make my own, so here's what I came up with:


![collatz graph]({{ "/images/collatz_graph_1000_small_2.png" | absolute_url }})

Also, check out the [humungo version](https://github.com/cbare/Etudes/blob/master/images/collatz_graph_1000.svg) and the [source](https://github.com/cbare/Etudes/blob/master/python/number_theory.py) that generated it using pygraphviz and GraphViz.

<figure style="float: left; height: 35%; width: 30%; margin-right: 1em;">
    <a href="https://xkcd.com/710/" target="_blank">
    <img
      src="/images/collatz_conjecture_xkcd.png"
      alt="xkcd.com/710"
    >
    </a>
</figure>

Why does this work? Thinking in terms of prime factors, the _half_ rule removes factors of 2. The _triple-plus-one_ rule increases the next value, but makes sure there's always at least one factor of 2 to remove. For the cases where _triple-plus-one_ yields more than one factor of 2, we've made a profit. After removing twos by _halving_, the remaining factors are less than the odd number we _tripled-plus-one_.

Longer paths tend to be chock-full of primes, like the sequence for 89 in which every odd number is a prime. Does knowing that a number is of the form _(3n+1)/2_ tell us anything about its prime factors? Does it help to remember that all primes are either _6n+1_ or _6n-1_?

I dunno, but the Collatz conjecture remains unproven for a reason.

